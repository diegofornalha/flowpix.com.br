# Visão geral do projeto

Use este guia para construir o backend da aplicação web do criador de emojis

# Stack tecnológica

- Utilizaremos Next.js, Supabase e Clerk

# Tabelas e buckets já criados

Bucket de armazenamento Supabase: "emojis"

TABELA emojis (
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
image_url TEXT NOT NULL,
prompt TEXT NOT NULL,
likes_count NUMERIC DEFAULT 0,
creator_user_id TEXT NOT NULL,
created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

TABELA profiles (
user_id TEXT PRIMARY KEY,
credits INTEGER DEFAULT 3 NOT NULL,
tier TEXT NOT NULL DEFAULT 'free' CHECK (tier IN ('free', 'pro')),
stripe_customer_id TEXT,
stripe_subscription_id TEXT,
created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);

# Requisitos

1. Criar usuário na tabela de usuários 0. Clerk já está configurado, não precisa se preocupar com isso
   1. Após um usuário fazer login via Clerk com sucesso, devemos obter o userId do Clerk e verificar se o userId existe na tabela 'profiles', correspondendo ao "user_id" (Fazer isso apenas se o login do usuário for bem-sucedido)
   2. Se o usuário não existir, então criar um usuário na tabela 'profiles'
   3. Se o usuário já existir, prosseguir e passar o user_id para funções como gerar emojis
2. Upload de emoji para o bucket de armazenamento "emojis" do Supabase;
   1. Quando o usuário gerar um emoji, fazer upload do arquivo de imagem do emoji retornado pelo Replicate para o bucket "emojis" do Supabase
   2. Adicionar uma linha na tabela 'emojis' onde a URL da imagem vai para a tabela "emojis" como "image_url", e creator_user_id será o user_id atual
3. Exibir todas as imagens no emojigrid
   1. Emoji grid deve buscar e exibir todas as imagens da tabela "emojis"
   2. Quando um novo emoji for gerado, o emojigrid deve ser atualizado automaticamente para adicionar o novo emoji ao grid
4. Interações de curtidas
   1. Quando o usuário clicar no botão 'curtir', o num_likes deve aumentar na tabela 'emojis'
   2. Quando o usuário descurtir, o num_likes deve diminuir na tabela 'emojis'

# Documentação

## Exemplo de upload de arquivos para o armazenamento Supabase

import { createClient } from '@supabase/supabase-js'

// Criar cliente Supabase
const supabase = createClient('url_do_seu_projeto', 'sua_chave_api_supabase')

// Upload de arquivo usando upload padrão
async function uploadFile(file) {
const { data, error } = await supabase.storage.from('nome_do_bucket').upload('caminho_do_arquivo', file)
if (error) {
// Tratar erro
} else {
// Tratar sucesso
}
}
